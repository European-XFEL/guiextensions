before_script:
  - source ci/prepare.sh "$CI_BUILD_NAME"

.test_build_template: &test_build
  script:
    - source ci/build.sh "$CI_BUILD_NAME"
    - source ci/test.sh "$CI_BUILD_NAME"
  only:
    - branches
  except:
    - master

.release_build: &release-build
  script:
    - source ci/build.sh "$CI_BUILD_NAME"
    - source ci/upload.sh "$CI_BUILD_NAME"
  only:
    - /^(\d+\.)(\d+\.?)(\d+)$/
  except:
    - branches
    - schedules

##### Release build #####

release build ubuntu16:
  image: europeanxfel/karabo-ci:ubuntu-16
  <<: *release-build

##### Test build #####

test:ubuntu16:
  image: europeanxfel/karabo-ci:ubuntu-16
  <<: *test_build
